<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <link rel="stylesheet" href="https://use.typekit.net/ger0etb.css">
    <link type="text/css" rel="stylesheet" href="css/main.css"/>
  </head>

  <body>
    <div class="container">
      <form action="https://unitehere.jotform.com/submit/212716536619864/" method="post" enctype="multipart/form-data" name="form_212716536619864" id="212716536619864" accept-charset="utf-8" autocomplete="on">
        <input type="hidden" name="formID" value="212716536619864" />
        <input type="hidden" id="JWTContainer" value="" />
        <input type="hidden" id="cardinalOrderNumber" value="" />
        <div class="row">
          <div class="col s12">
            <img class="banner" src="img/33banner.png" />
          </div>
        </div>

        <div class="row">
          <div id="cover_parent" class="col l6 s12">
            <div class="row">
              <p class="pitch_text">Having a union and a contract would mean having a say when it comes to things like: salaries with a cost-of-living adjustment, health care benefits, vision & dental benefits, working conditions, mental health benefits, health & safety protections, policies for teaching & research, grievance procedures, protections for international student workers . . .</p>
            </div>
            <div class="row">
              <h3 class="white-font right-align">Across the country, graduate student workers are unionizing.</h3>
              <h3 class="right-align">WE CAN TOO.</h3>
            </div>
            <div class="row">
              <h1 class="white-font">What do you want to win?</h1>
            </div>




          </div>
          <div id="form_parent" class="col l6 s12">
            <div class="row off-white-bg">
              <div class="col s12">
                <h3>Join the campaign.</h3>
              </div>
            </div>



            <div class="row light-border zvm padded">
              <div class="col s12">

                <div class="row">
                  <div class="col s12">
                    <h2>I want</h2>
                  </div>
                </div>
                <div class="row">
                  <div class="input-field col s12">
                    <input type="text" id="want_field" name="q22_iWant" required>
                    <label for="want_field">What do you want to win?*</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col s12">
                    <h2>& a union!</h2>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">account_circle</i>
                    <input type="text" id="first_4" name="q4_name[first]" required>
                    <label for="first_4">First Name*</label>
                  </div>
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix small-only"></i>
                    <input type="text" id="last_4" name="q4_name[last]" required>
                    <label for="last_4">Last Name*</label>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">apartment</i>
                    <input type="text" id="input_6" name="q6_department" required>
                    <label for="input_6">Department*</label>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">email</i>
                    <input type="text" id="input_8" name="q8_nonyaleEmail" required>
                    <label for="input_8">Non-Yale Email*</label>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col s12">
                    <i class="material-icons prefix">phone_iphone</i>
                    <input type="text" id="phone" name="q7_phoneNumber[full]">
                    <label for="phone">Phone Number</label>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix">home</i>
                    <input type="text" id="input_20_addr_line1" name="q20_address[addr_line1]">
                    <label for="input_20_addr_line1">Street Address</label>
                  </div>
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix small-only"></i>
                    <input type="text" id="input_20_addr_line2" name="q20_address[addr_line2]">
                    <label for="input_20_addr_line2">Street Address (Line 2)</label>
                  </div>
                </div>

                <div class="row">
                  <div class="input-field col m6 s12">
                    <i class="material-icons prefix"></i>
                    <input type="text" id="input_20_city" name="q20_address[city]">
                    <label for="input_20_city">City</label>
                  </div>
                  <div class="input-field col m3 s12">
                    <i class="material-icons prefix small-only"></i>
                    <input type="text" id="input_20_state" name="q20_address[state]">
                    <label for="input_20_state">State</label>
                  </div>
                  <div class="input-field col m3 s12">
                    <i class="material-icons prefix small-only"></i>
                    <input type="text" id="input_20_postal" name="q20_address[postal]">
                    <label for="input_20_postal">Zip Code</label>
                  </div>
                </div>

                <div class="row">
                  <div class="col s12">
                    <label>(* = required)</label>
                  </div>
                </div>

              </div>
            </div>
          </div> <!-- form_parent col -->
        </div> <!-- parent row -->


        <div class="row">
          <div class="col s12">
            <div class="row">
              <div class="col m4 s12 grey lighten-5 z-depth-1">
                <img src="img/example1.jpeg" alt="" class="example-img">
              </div>
              <div class="col m4 s12 gray lighten-5 z-depth-2">
                <img src="img/example6.jpeg" alt="" class="example-img">
              </div>
              <div class="col m4 s12 grey lighten-5 z-depth-1">
                <img src="img/example2.jpeg" alt="" class="example-img">
              </div>
            </div>
          </div>
        </div>


        <div class="row light-border padded">
          <div class="col s12">
            <h3>Show your support by sending a photo!</h3>
            <div class="row">
              <div class="col s12">

                <a class="margined waves-effect waves-light btn-large dark-magenta-bg" onclick="createPdf(true)">
                  <i class="material-icons left">print</i>Print My Action
                </a>
                <a class="margined waves-effect waves-light btn-large dark-magenta-bg" onclick="createPdf(false)">
                  <i class="material-icons left">download</i>
                  Download My Action
                </a>
                <a class="margined grey-text" href="union_yes_blank.pdf">
                  I want to write my own (Download blank action).
                </a>
              </div>
            </div>
            <div class="row">
              <div class="col s12">
                <iframe src="" style="display: none" id="action_print_frame"></iframe>

                <label>Upload a photo of you with the reason why you want a union.</label>
                <div class="file-field input-field">
                  <div class="btn dark-magenta-bg">
                    <span>Upload File</span>
                    <input type="file" id="input_11" name="q11_shareA[]" multiple data-file-accept="pdf, doc, docx, xls, xlsx, csv, txt, rtf, html, zip, mp3, wma, mpg, flv, avi, jpg, jpeg, png, gif" data-limit-file-size="Yes" data-file-maxsize="10854" data-file-minsize="0" data-file-limit="" data-component="fileupload" />
                  </div>
                  <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Upload multiple files" />
                  </div>
                </div>
              </div>
            </div>
            <div class="row" id="signature_parent">
              <div class="col m8 offset-m2 s12">
                <p>I, <span id="my_name"></span>, authorize Local 33â€“UNITE HERE to use my photo for campaigns in print and online, including on local33.org and on social media such as Twitter, Facebook, Instagram.</p>
                <br>
                <label for="signature">Signature (required)</label>
	              <div id="signature" class="z-depth-1 card-panel"></div>
                <input id="input_9" name="q9_signature" type="hidden" required/>
              </div>
            </div>
          </div>
        </div>

        <div class="row light-border padded">
          <div class="col s12">
            <h3>All hands on deck.</h3>
            <label>
              <input type="checkbox" id="input_21_0" name="q21_getMore"/>
              <span>I would like to get more involved with the campaign for a union!</span>
            </label>
          </div>
        </div>

        <div class="row">
          <div class="col s12 center-align">
            <button class="btn waves-effect waves-light btn-large dark-magenta-bg" type="submit" name="action" id="submit_btn">
              Submit
              <i class="material-icons right">send</i>
            </button>
          </div>
        </div>
      </form>
    </div> <!-- container -->

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit/dist/fontkit.umd.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <!--[if lt IE 9]>
	  <script type="text/javascript" src="js/jSignature/flashcanvas.js"></script>
	  <![endif]-->
    <script src="js/jSignature/jSignature.min.js"></script>
    <script >


      async function generatePdf(auto_print, uri=true) {
        const existingPdfBytes =
          await fetch("./union_yes_blank.pdf").then(res => res.arrayBuffer());

        var bytes = new Uint8Array(existingPdfBytes);
        const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
        const helveticaFont = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);

        const pages = pdfDoc.getPages();
        const { width, height } = pages[0].getSize();

        const text = $("#want_field").val();

        var textSize = 150;
        var textWidth = helveticaFont.widthOfTextAtSize(text, textSize);
        var textHeight = helveticaFont.heightAtSize(textSize);

        while(textWidth > height*0.9) {
          textSize -= 1;
          textWidth = helveticaFont.widthOfTextAtSize(text, textSize);
          textHeight = helveticaFont.heightAtSize(textSize);
        }

        pages[0].drawText(text, {
          rotate: PDFLib.degrees(-90),
          x: width / 2 - textHeight / 2,
          y: height / 2 + textWidth / 2,
          size: textSize,
          font: helveticaFont,
        });

        if(auto_print) {
          pdfDoc.addJavaScript("main", "this.print()");
        }

        if(uri) {
          return await pdfDoc.saveAsBase64({ dataUri: true });
        } else {
          return await pdfDoc.save();
        }
      }


      function createPdf(auto_print) {
        generatePdf(auto_print).then(function (pdfDataUri) {
          if(auto_print) {
            w = window.open(pdfDataUri);
          } else {
            var element = document.createElement('a');
            element.setAttribute('href', pdfDataUri);
            element.setAttribute('download', "my_action.pdf");
            document.body.appendChild(element);
            element.click();
          }
        });
      }

      $(document).ready(function() {


        function refresh_sig_name(e) {
          $("#my_name").html($("#first_4").val() + " " + $("#last_4").val());
        }
        $("#first_4,#last_4").bind("input", refresh_sig_name);
        $("#first_4,#last_4").bind("click", refresh_sig_name);
        refresh_sig_name();

        $("#input_11").bind("input", function(e) {
          $("#signature_parent").slideDown();
          $("#signature").jSignature({
              'background-color': 'transparent',
              'decor-color': 'transparent',
          });

          $("#signature").bind("change", function() {
            $("#input_9").val($("#signature").jSignature("getData"));
          });


        });
        if($("#input_11").val().length > 0) {
          $("#input_11").trigger("input");
        }

        if(window.innerWidth > 600) {
          $("#cover_parent").css({"height": "calc(" + $("#form_parent").css("height") + " - 2rem)"});
        }

        function validateForm() {

          var signature = $("#input_11").val().length == 0 ||
            $("#signature").jSignature('getData', 'native').length > 0;

          if(signature == false) alert("Your signature is required.");
          return signature;
        }

        $("#212716536619864").submit(function(e) {
          if(!validateForm()) return false;

          generatePdf(false, false).then(function(pdf_file_bytes) {
            var form_data = new FormData(document.getElementById("212716536619864"));
            const bytes  = new Uint8Array( pdf_file_bytes );
            const blob   = new Blob( [ bytes ], { type: "application/pdf" } );
            var pdf_file = new File(
              [blob],
              $("#first_4").val() + "_" + $("#last_4").val() + "_action.pdf",
              { type: "application/pdf" });

            form_data.append("q11_shareA[]", pdf_file);

            $.ajax({
              url: 'https://unitehere.jotform.com/submit/212716536619864/',
              type: 'POST',
              data: form_data,
              processData: false,
              contentType: false,
              success: function() {

              },
              error: function() {
                $("#submit_btn").attr({"disabled": false}).html(
                  "Submit <i class='material-icons right'>send</i>");
              },
            });
          });

          $("#submit_btn").attr({"disabled": true}).html(
            "Submitting...<i class='material-icons right'>pending</i>");

          e.preventDefault();
        });

	    });


    </script>
  </body>
</html>
